\chapter{Techniques}
\label{Chapter4}
\lhead{Chapter 4. \emph{Codes}}

Throughout this thesis my goals were to identify SLSNe in a number of surveys. I have approached this problem using a variaty of tools and techniques which I describe in this chapter. The methods of classification SLSN described in this chapter span a number of methods. In the early parts of this thesis I used an approached based on modelling of SLSNe using the popular spin-down of a magnetar model \sref{sec:SLAP}. While this technique was successful in identifying a new SLSN in the SNLS it was found to be insufficient in the case of mode diverse but also noisy DES data. To solve this problem I have followed a popular path for classification style problems by approaching it using a machine learning approach. It is the preparation for the sample building methods, described further in \cref{Chapter5}, that form the second part of this chapter. The use of machine learning means that the majority of the work is not put into the understanding of the parameter space of the model applied to the data and any potential cuts that need to be made by currating and cleaning the data. Our approach is to simulate DES using all tranient models that are currently availabe to us. This includes similating SNIa, CCSN, SLSN as well as random noise and AGN activity.

While the models of SNIa are mature and ready to be applied to our work the simulations of CCSN could not have been accieved that easily. CCSN are usually faster and fainter than SNIa resulting is a significantly smaller sample of well observed objects. Most of them are also not observed using the same spectoscopic thoroughness making the a less understood class of objects. In recent years the interest in modeling this objects has increased dramatically with projects such as LSST underway. In this chapter I describe our approach to producing templates of CCSN as well as simulating them in a number of surveys. This project has originally been started as part of the LSST transients classification challenge however later I have applied it to DES to produce samples of both hydrogen rich and poor CCSN.

The last, but perhaps the most key, technique descrined in this chapter is Gaussian Processing. As the DES data was not observed on regular cadance, it would be impossible to apply any machine learning technique to good success to the row data. We used GPs as a method of modelling the confidence regions of the underlying light curves for the observed and simulated DES objects in a model-independant way. This was key as at the next stage of the process it would be "BAD" if instead of classifing the objects we uncover the underlying model instead of the data itself.

This chapter is divided in the following way. I begin by describing the method of modelling of SLSNe using the magnetar model in conjunction with SED templates. I then follow this by a discussion of the method as applied to the search for SLSNe in DES as well as their pre-peak 'bumps' and other rapidly evolving transients. Next, I describe the process of Gaussian Processing light curves as a model-independant approach to approximating the original data. Finally I describe the technique behind simulating samples of CCSN as used for machine learning classification of SLSNe.

\section{Modeling SLSN Light Curves} \label{sec:SLAP}
Throughout this thesis the modelling of SLSNe light curves plays a pivotal role. The measurement of the rate of SLSNe presented in \cref{Chapter3} as well as the search for SLSNe in DES described in \cref{Chapter5,Chapter6} uses a definition of SLSNe based on the spin-down of the magnetar model (magnetar model) [CITE]. In both cases a simpler model describing SLSNe using and linearly expanding and cooling photosphere has also been investigated but eventually rejected in favour of the magnetar model. I begin by giving a short decription of this model and its drawbacks before describing the improvements brought upon by the magnetar model. When modelling a SLSNe light curve there are two independant (but equally important) areas that contribute to the accuracy of the model: the spectral energy distribution (SED) of the SN, and its evolution with time.

The need to model the SED of a SN could be avoided if we used an approach which purely relied on the bolometric lightcurves as opposed to multi-band observations. While from the implemetation point of view these models are easier to use, and are common in the literature [CITE: Cosimo, Andreas and Nicolls], they do not take into consideration colour information about the SN which could provide further constraints for the properties of the SNe. It has been previously shown \citep{2011ApJ...743..114C,2013ApJ...779...98H,2015MNRAS.449.1215P,2014ApJ...797...24V} that the SLSN SED can be accurately approximated, in the visible spectrum, by a slowly evolving (nearly) perfect blackbody, with characteristic broad lines of O\,II. However, this approximation breaks down in the near UV due to the prominant broad absorption features which can be attributed to Mg\,II, Fe\,III, C\,II, Co\,III, Si\,III and Ti\,III \citep[see][for line identifications]{2016MNRAS.458.3455M}.

\subsection{Improving the blackbody approximation}
I propose a method of improving the blackbody approximation for the SLSN SED by superimposing absorption template onto the simple blackbody SED. In order to derive such template, I follow the method used in \citet{2014ApJ...797...24V} by fitting the Planck function to several featureless, 50$\AA$ wide regions of the spectrum in order to measure the underlined blackbody continuum in the SED, as shown in figure \ref{fig:specTemplate}. The resulting fits show that the absorption, relative to the blackbody, is low in the regions of $\lambda>3000\AA$, and increases drastically in the bluer regions of the spectrum.

The time evolution of the spectra appears to be weak in comparison to other SNe, making it possible to approximate the SED at any epoch using the Planck function, where the temperature evolves with time, and a single absorption template. The absorption is calculated as a ratio of the observed flux to the continuum blackbody fit. At the time this work was undertaken, the number of SLSNe with good UV coverage was small, with only the spectra of iPTF13ajg \citep{2014ApJ...797...24V}, SCP06F6 \citep{2009ApJ...690.1358B} and SNLS-06D4eu \citep{2013ApJ...779...98H} providing sufficient data. Do due to the observer-frame coverage of their respective spectra, our spectral templates cover a rest-frame wavelength range of 1620--3320\,\AA\ (SNLS-06D4eu), 1800--3800\,\AA\ (SCP06F6) and 1800--5250\,\AA\ (iPTF13ajg).
\begin{figure}
\centering
\includegraphics[width=\textwidth]{Figures/Chapter4/specTemplate}
\caption{iPTF13ajg is fitted with the Planck function. The spectrum of iPTF13ajg (green) can shows a good agreement with the blackbody (red) at $\lambda>3000\AA$. At lower wavelengths a strong deviation from the model is observed, highlighting the need for a correction to the model. The ratio between the observed spectrum and the continuum give a measure of the absorption strength as a function of wavelength and can be used in modelling the SLSN SED.}
\label{fig:specTemplate}
\end{figure}

\subsection{Modelling the SED evolution}
The posibility of describing the SEDs of SLSNe as blackbodies greatly simplies the
modelling of its evoution. The model is required to provide only the thermal and radial evolution of the photoshere, therefore removing the need for complex modelling such as radiative transfer or hydrodynamic simulations.

\subsubsection{Fireball model}
Perhaps the simplest approach to modelling the SED evolution is to assume that the SN, with an initial radius R$_{0}$ and initial temperature T$_{0}$ expands at a constant rate while cooling down also at a current rate as seen in \eref{eq:Howell}
\begin{align}
\label{eq:Howell}
R(t) &= R_0 + \dot{R}t &&\\
T(t) &= T_0 - \dot{T}t &&
\end{align}
\noindent While such model does not have any physical motivation, \citet{Howell2013} showed that it provides a good, first-order approximation to the light-curves of SLSNe. Due to its simplicity, the model appeared as an attractive prospect for the modelling of SLSN SEDs. However, our testing showed that while it produces a good fit to a SLSN around the maximum light (<+30days) it is not able to capture the slow evolution in the tale of the light curve as seen in \fref{fig:BB_Mag} making in infarable in comparison with the more complex magnetar model.

\begin{figure}
\includegraphics[width=\textwidth]{Figures/Chapter4/BB_Mag_comp}
\caption{The SLSN PS1-11ap $griz$ light curve \citep{2014MNRAS.437..656M} compared to two models describing its photometric evolution. In the upper panel, the model is a simple expanding and cooling blackbody fitted to data around maximum light only, and in the lower panel the model is our `absorbed' magnetar model fitted to the entire light curve. In the case of the magnetar model, the spectrum of SNLS-06D4eu \citep{2013ApJ...779...98H} has been used as an absorption template in the modelling of the SED \sref[see]{sec:KCorrection}). Note that while both models can produce reasonable fits around the peak of the light cuve, the black body model is not able to reproduce the characteristic late-time behaviour of SLSNe. Light curve phases are measured with respect to peak brightness in the rest-frame \textit{u}-band as predicted by our magnetar model fit.}
\label{fig:BB_Mag}
\end{figure}

\subsubsection{Magnetar model}
\label{sec:Magnetar}
To fully capture the evolution of the SED with time we must employ a model for an engine that provides the late time energy deposition needed to explain the photospheric velocity and temperature observed in SLSNe. While still a matter of active debate in literature, in recent years the birth and spin-down of a magnetar model has appeared as the strongest candidate to explain these extremely luminous events \citep{2013ApJ...770..128I,2013Natur.502..346N}. In this model, SLSNe begin as CCSN with a magnetar, a rapidly rotating, highly magnetised neutron star, born at its core. As the magnetar spins down due to the interactions with its environment, it dissipates its energy in the form of high energy radiation that is then captured by the expanding ejecta and thermalised to produce the observed blackbody SED \citep{2010ApJ...717..245K,2010ApJ...719L.204W,2012MNRAS.426L..76D}.

I follow the method from \citet{2013ApJ...770..128I}, based on the Arnett law for the energy diffusion though a SN ejecta \citep{Arnett1982} and the energy radiated by the central engine from \citet{Bildsten2013,Wosley2012}. In order to model the bolometric luminosity, $L$, of a SLSN as a function of time, $t$, we use equation \ref{Eq:MagnetarLum}:
\begin{equation}
L(t) = 4.9\times 10^{46}\,e^{ -(t / \tau_\mathrm{m})^2 }\delta(t) \int_{0}^{t} \frac{2t'}{\tau_\mathrm{m}^2}\,e^{(t'/\tau_\mathrm{m})^2}\,\frac{B_{14}^{2}\,P_{\mathrm{ms}}^{-4}}{\left(1+t'/\tau_\mathrm{p}\right)^2} dt',
\label{Eq:MagnetarLum}
\end{equation}
\begin{equation}
\label{Eq:SDPeriod}
\tau_{p} = 4.7B_{14}^{-2}P_{ms}^{2}days
\end{equation}
\noindent where $\tau_\mathrm{m}$ is the diffusion timescale, $B_{14}$ is the neutron star magnetic field in units of $10^{14}$\,G, $P_{\mathrm{ms}}$ is the magnetar spin period in ms, $\delta(t)$ is the deposition function or trapping coefficient, and $\tau_\mathrm{p}$ is the magnetar spin-down timescale, is defined in \eref{Eq:SDPeriod}, inferred from $B_{14}$ and $P_{\mathrm{ms}}$.

Physically $\tau_M$ is proportional to the ejecta mass($M_{ej}$) which is sometimes chosen as the fit parameter instead. The two parameters can be interconvert using equation \ref{Eq:Mej}, where $E$ is the explosion energy and $\kappa$ the opacity of ejecta.
\begin{equation}
\label{Eq:Mej}
M_{ej} = (\frac{\tau_{M}}{10days})^{4/3}(\frac{\kappa}{0.1cm^2g^{-1}})^{-2/3}(\frac{E_k}{10^{51}erg})^{1/3}M_{\odot}
\end{equation}
\noindent It has been shown \citep{2013ApJ...770..128I,2014ApJ...796...87I,2015MNRAS.452.3869N,2015MNRAS.449.1215P} that the opacity and the explosion energy parameters have only a weak affect the quality of fitting and have therefore been fixed as $\kappa = 0.1cm^2g^{-1}$ and $E = 10^{51}$erg respectively.

The velocity of the ejecta, $v_{core}$ are assumed to be constant and value can be found using the inferred mass of the ejecta, $M_{ej}$ and its kinetic energy, $E_{mag}$ (\eref{Eq:vcore}), which in turn depends on the explosion energy and the energy released by the spin down of the magnetar, shown in \eref{Eq:Emag}:
\begin{align}
\label{Eq:Emag}
E_{mag} = 4.9\times10^{46} B^2 P^{-4} \tau_{P}  \text{ erg} \\
E_k = 10^{51} + 0.5 \times E_{mag} \text{ erg}\\
\label{Eq:vcore}
v_{core} =  \sqrt{\frac{10 E_{k}}{3 M_{ej}}} \text{ cm s}^{-1}
\end{align}

\paragraph{Trapping coofficient}
The trapping coefficient, $\delta(t)$, is defined as the fraction of the high-energy radiation produced by the central engine that get trapped, and subsequently reproduced, by the ejecta. It is often assumed in the literature that the traping coofficient is time-independent and close to unity, implying the full trapping of radiated by the supernova ejecta \citep{2013ApJ...770..128I,2015MNRAS.449.1215P,2015MNRAS.452.3869N}. In this work I use a correction introduced by \cite{2015ApJ...799..107W} with a time-dependent trapping coefficient:
\begin{equation}
\delta(t) = 1 - \exp\left({-\frac{9\kappa \mathrm{M}_{\mathrm{ej}}^{2}}{40\pi  E_k} t^{-2}} \right),
\label{Eq:Wang}
\end{equation}
\noindent where $\mathrm{M}_{\mathrm{ej}}$ is the ejecta mass, $E_k$ is the explosion energy, and $\kappa$ is the opacity. $\mathrm{M}_{\mathrm{ej}}$ is proportional to $\tau_\mathrm{m}$, $E_k$ and $\kappa$ \citep{2013ApJ...770..128I}. We again fix the explosion energy to be $E_k = 10^{51}$\,erg and the opacity as $\kappa =0.1$\,cm$^2$g$^{-1}$.

Using this time-dependent trapping coefficient improves the late-time fit to the light curve. For a typical SLSN we calculate $\delta \simeq 1$ up to 75 days post explosion. However, as the ejecta opacity to high energy photons decreases with time we find $\delta \simeq 0.8$ at 150 days post explosion, emphasising the importance of this correction in the late time light curves.

\paragraph{Deriving Radius and Temperature}
In its simplest form the magnetar model only predicts the total radiated energy of the SN and does not make any predictions about the SED of the object. It is therefore most commonly used with bolometric light curves, synthesised from the photometry. \cite{2013ApJ...770..128I} however shows that it is possible to predict the photospheric radius of a SN based on this model:
\begin{align}
r_{core}(t) = v_{core}  t \\
\rho_{core}(t)= \frac{3 M_{ej}}{4  \pi  r_{core}^3(t)}\\
\tau_{core}(t) = \kappa  \rho_{core}(t) v_{core} t
\end{align}

While the radius of the photosphere exceeds that of the core ejecta, it can be found using equation \ref{Eq:R19}.
\begin{equation}
\label{Eq:R19}
R(t) = r_{core}(t) \left(\frac{\alpha - 1}{\tau_{core}(t)}\right)^\frac{1}{1 - \alpha}
\end{equation}
However, when the photosphere recedes into the core the radius is instead found by equation \ref{Eq:R20}.
\begin{equation}
\label{Eq:R20}
R(t) = r_{core}(t) - \frac{1 - \frac{\tau_{core}(t)}{\alpha - 1}}{\kappa \rho_{core}(t)}
\end{equation}

Combining this with the total luminosity and assuming that the object radiates as a spherical blackbody gives us the photospheric temperature. This can be injected into the Planck law to give an approximation for the SED of a SLSN. This method allows for the magnetar model to be fit directly to the multi-band photometry without the need to produce the pseudo-bolometric light curves. We combine this with the absorption templates to produce a model of the SLSN spectral evolution as a function of time.

\subsection{SLAP}
Upon establishing an approach for modelling SLSNe it was important to encapulate it in a software package capable of modelling the literature sample of SLSNe, was able to fit any transient passed to it without without crashing, produce the plots and statistics for the models as well as simualate SLSNe based on the combination of input parameters and absorption templates.

Simulataniously all projects as part of this thesis dependant in to some extend on modelling of SLSNe, not only based on the existing objects and moving them to different redshifts but also by interpolating the training sample in order to provide new training samples, similar but not identical to the published objects

There were xx main concerns when designing the code used for modelling of SLSNe. We needed it to be fast, both in terms of the fitting of light curves as well as modelling of them. The initial design was done in Python which allowed us to make sure that we understand the model and agree with its resuls. Later on the whole code base was moved to C++ to make it faster.

[MAYBE PUT A LIST OF ALL THE REQUIREMENTS THAT I WANTED THE CODE TO HAVE AND THEN USE THE PARAGRAPHS TO DESCRIBE HOW I HAVE ACHIEVED THAT]

\subsubsection{Code structure}
The code was written in a modular way, using the object orientated paradigm and polymorphism to allow us to implement any model as a plugin to the code meaning based that we were able to test even large changes as well as combinations of models. The modelling was structured around a base \textsc{Model} class which would take any SED model and convert it into an observed photometry at any input redshift. Using the polymorphic design of the code, it was possible to implement a basic magnetar model and use any required model extension simply as a 'plug-in' to the base model. [THIS NEEDS A LOT MORE WORK]

\subsubsection{Model extensions}
While the basic magnetar model is already a very good fit to the light curves of SLSNe, in some cases such as DES14X3taz it was impossible to fully model the SN without introducing several further assumptions. For this purpose a number of magnetar model extensions were introduced which I will brienfly introduce in the context of the improvements to the modelling they have brough. It is important to highlight here that there were never used in teh simulation of SLSNe for both the Rate of SLSNe in \cref{Chapter3} nor the creation of the DES artificial training sample in \cref{Chapter5} as the base model remains a good fit around the maximum light which, in case of the DES and SNLS seasons, is the region observed by our data. The extensions were used mostly as the demonstration of the capabilities \textsc{SLAP}.

\paragraph{\citet{Piro2015}}
Upon the discovery of DES14X3taz the question of the engine powering the pre-cursor bump was an important one to answer. \citet{Smith2016} showed that the peak is well explained by a model wherein the supernova explodes inside of an envelope of dense and extended wind. The shock-breakout which usually would be observed as a short, <1day, flash of high energy radiation gets reprocessed into a longer duration emission of lower energy radiation. This model is highly degenerate in the ejecta mass and explosion energy parameter space. However, as these parameters also play part in the modelling of the spin-down of a magnetar. The combination of these two models gave us an unprecedented opportunity to derive these parameters directly from the observed data.

In this version of the model, we intoduce a new free parameter, t$_d$, measuring the delay between the explosion of the SN and the onset of the magnetar spin-down. These have not been previosly considered to occur at different times \citep{Nicolls} as there are currently no models that require a delay between the supernova explosion and the formation of the magnetar[ME: NEED TO CHECK THIS, THERE MIGHT BE A PAPER BY WOOSLEY]. However, I have found though the modelling of DES14X3taz that it is impossible to reconcile these the magnetar and extended shock models without the introduction of this parameter. Further evidence for is shown in \cref{par:R0nonzero} where the best fit magnetar model for DES14X3taz is shown to require the radius of the photosphere to already be largely extended, consistent with a t$_d ~\sim$ 17days (assuming a constant explansion velocity), which matches that found in \citet{Smith2016}

\paragraph{R$_0$ > 0}
\label{par:R0nonzero}
While it is currently widely believed that a magnetar is capable of producing the correct injection of energy into a SN ejecta to result in the SLSN, the exact process though which the high-energy radiation produced by the magnetric breaking is not transported into the outer shells of the ejecta. If the injection of energy did not precisely coincide with the explosion time of the star, the SN could go though a dark phase followed by a rapid rebrightening. In several cases including PS1-11ap and DES14X3taz (where we exclude the pre-peak bump data), the magnetar model does not correctly fit the earliest stages of the light curve.

In order to investigate this delay, I have introduced a non-zero initial radius of the progenitor. While the radius of the progenitor star is never null, it is usually negligible in comparison with the expansion velocity of the ejecta. However, in the case of DES14X3taz and PS1-11ap I have found initial radiuses comparable to the ejecta which has undergone expansion at a constant velocity for 17 and xx days respectively. PS1-11ap has no observations prior to its first detections making it impossible to determine if the object was associated with a pre-peak events. This technique, however, can provide insight into the mechanism behind the magnetar energy injection even in the absence of the earliest and pre-explosion epochs.

\paragraph{Nickel decay}
Another intersting questions which we were able to investigate is the contribution from the decay of Ni56 and Co56 as an additional energy source powering the ejecta. I have introduced this in order to investigate this mechanism as a potential cause of the peculiarly flat evolution of DES13S2cmm. In this model I simply add the contribution from the decay of these radioactive elements into the bolumetric luminosity of the SN and then treat the model as normal from there on. In the case of the test DES13S2cmm, the radioactive decay was not able to describe the observed tale, further deepening its mistery. This is further investigated in Angus (in prep.).

\subsubsection{Model fiiting}
A large part of the success of SLAP in terms of modelling SLSNe came thanks to my work on optimising the fitting routines used within the package. We set out as one of the aims for \textsc{SLAP} that all the fitting has to happen in a fully automated way without the need for manual input or fine-tunning of parameters. This was crucial in order to be able to perform fitting on large datasets containing thousands of objects where only a small fraction would likely make a good match to the models used. Furthermore we do not wish to intruduce any human biases to the fitting procedure, particuarly in the case of the ML training sample.

\paragraph{Least-Squares fitting}
Initially, while testing the fitting technique we have relied on a Levenbergâ€“Marquardt non-linear least sqares fitter, \textsc{MPFIT} [CITE] based on \textsc{Fortran}'s \textsc{LMFIT} [CITE]. While the first signs were possitive, we have very soon realsied that the quality of our firts have strongly dependant on the choice of the iniatial guess for the best fit parameters.

In order to investigate the cause of this, I have performed a fit using some of the best sampled light curves in our training sample of SLSNe using the grid-search approach where we simply divide the magnetar model parameter space in an evenly spaced grid before trying all values. This demonstrated that there are many local minima within the paramters space demonstrating the need for a global optimisation approach where all degeneracies, and local minima can be explored without stopping like in the case of a MPFIT regression.

\paragraph{\textsc{MultiNest}}
In the case of a 

\subsubsection{pyMagnetar}
text

\section{Searching for Fast Transients}
text
\subsection{Searching for Bumps of SLSNe}
text
\subsection{Searching for Rapidly Evolving Transients}
text

\section{Modeling CCSN}
text
\subsection{CoCo}
text
\subsection{pyCoCo}
text
\subsection{SNIb/c SED UV Extensions}
text
\subsection{SNII with CoCo}
text

\section{Gaussian Processing}
text
\subsection{Theory}
text
\subsection{Choice of Kernels}
text
\subsection{Interpolating Light Curves}
text
